<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Explore the data | Boosting methods: Theory and application in R</title>
  <meta name="description" content="Boosting methods: Theory and Application in R (XGBoost)" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Explore the data | Boosting methods: Theory and application in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Boosting methods: Theory and Application in R (XGBoost)" />
  <meta name="github-repo" content="EmanuelSommer/boosting_methods" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Explore the data | Boosting methods: Theory and application in R" />
  
  <meta name="twitter:description" content="Boosting methods: Theory and Application in R (XGBoost)" />
  

<meta name="author" content="Emanuel Sommer" />


<meta name="date" content="2021-05-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="theory.html"/>
<link rel="next" href="modeling.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Boosting methods</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="theory.html"><a href="theory.html"><i class="fa fa-check"></i><b>3</b> Theory</a>
<ul>
<li class="chapter" data-level="3.1" data-path="theory.html"><a href="theory.html#the-powerful-idea-of-gradient-boosting"><i class="fa fa-check"></i><b>3.1</b> The powerful idea of gradient boosting</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="theory.html"><a href="theory.html#forward-stagewise-additive-modeling"><i class="fa fa-check"></i><b>3.1.1</b> Forward Stagewise Additive Modeling</a></li>
<li class="chapter" data-level="3.1.2" data-path="theory.html"><a href="theory.html#robust-loss-functions-for-regression"><i class="fa fa-check"></i><b>3.1.2</b> Robust loss functions for regression</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="theory.html"><a href="theory.html#general-gradient-tree-boosting"><i class="fa fa-check"></i><b>3.2</b> General gradient tree boosting</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="theory.html"><a href="theory.html#numOpt"><i class="fa fa-check"></i><b>3.2.1</b> Numerical optimization</a></li>
<li class="chapter" data-level="3.2.2" data-path="theory.html"><a href="theory.html#single-tree-depth"><i class="fa fa-check"></i><b>3.2.2</b> Single tree depth</a></li>
<li class="chapter" data-level="3.2.3" data-path="theory.html"><a href="theory.html#combOver"><i class="fa fa-check"></i><b>3.2.3</b> Combat overfitting</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="theory.html"><a href="theory.html#xgboost-a-highly-efficient-implementation"><i class="fa fa-check"></i><b>3.3</b> XGBoost a highly efficient implementation</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="theory.html"><a href="theory.html#regularized-loss"><i class="fa fa-check"></i><b>3.3.1</b> Regularized loss</a></li>
<li class="chapter" data-level="3.3.2" data-path="theory.html"><a href="theory.html#shrinkage-and-subsampling"><i class="fa fa-check"></i><b>3.3.2</b> Shrinkage and subsampling</a></li>
<li class="chapter" data-level="3.3.3" data-path="theory.html"><a href="theory.html#even-more-tweaks"><i class="fa fa-check"></i><b>3.3.3</b> Even more tweaks</a></li>
<li class="chapter" data-level="3.3.4" data-path="theory.html"><a href="theory.html#hyperparameters-overview"><i class="fa fa-check"></i><b>3.3.4</b> Hyperparameters overview</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="eda.html"><a href="eda.html"><i class="fa fa-check"></i><b>4</b> Explore the data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="eda.html"><a href="eda.html#burnout-data"><i class="fa fa-check"></i><b>4.1</b> Burnout data</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="eda.html"><a href="eda.html#train-test-split"><i class="fa fa-check"></i><b>4.1.1</b> Train-test split</a></li>
<li class="chapter" data-level="4.1.2" data-path="eda.html"><a href="eda.html#quick-general-overview"><i class="fa fa-check"></i><b>4.1.2</b> Quick general overview</a></li>
<li class="chapter" data-level="4.1.3" data-path="eda.html"><a href="eda.html#what-about-the-outcome-variable"><i class="fa fa-check"></i><b>4.1.3</b> What about the outcome variable?</a></li>
<li class="chapter" data-level="4.1.4" data-path="eda.html"><a href="eda.html#distribution-and-main-effects-of-the-predictors"><i class="fa fa-check"></i><b>4.1.4</b> Distribution and main effects of the predictors</a></li>
<li class="chapter" data-level="4.1.5" data-path="eda.html"><a href="eda.html#relationships-between-the-predictors"><i class="fa fa-check"></i><b>4.1.5</b> Relationships between the predictors</a></li>
<li class="chapter" data-level="4.1.6" data-path="eda.html"><a href="eda.html#some-feature-engineering"><i class="fa fa-check"></i><b>4.1.6</b> Some feature engineering</a></li>
<li class="chapter" data-level="4.1.7" data-path="eda.html"><a href="eda.html#create-the-recipe"><i class="fa fa-check"></i><b>4.1.7</b> Create the recipe</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="eda.html"><a href="eda.html#insurence-data"><i class="fa fa-check"></i><b>4.2</b> Insurence data</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="eda.html"><a href="eda.html#train-test-split-1"><i class="fa fa-check"></i><b>4.2.1</b> Train-test split</a></li>
<li class="chapter" data-level="4.2.2" data-path="eda.html"><a href="eda.html#a-general-overview"><i class="fa fa-check"></i><b>4.2.2</b> A general overview</a></li>
<li class="chapter" data-level="4.2.3" data-path="eda.html"><a href="eda.html#what-about-the-outcome"><i class="fa fa-check"></i><b>4.2.3</b> What about the outcome?</a></li>
<li class="chapter" data-level="4.2.4" data-path="eda.html"><a href="eda.html#distribution-and-main-effects-of-the-predictors-1"><i class="fa fa-check"></i><b>4.2.4</b> Distribution and main effects of the predictors</a></li>
<li class="chapter" data-level="4.2.5" data-path="eda.html"><a href="eda.html#relationships-between-the-predictors-1"><i class="fa fa-check"></i><b>4.2.5</b> Relationships between the predictors</a></li>
<li class="chapter" data-level="4.2.6" data-path="eda.html"><a href="eda.html#create-the-recipe-1"><i class="fa fa-check"></i><b>4.2.6</b> Create the recipe</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="modeling.html"><a href="modeling.html"><i class="fa fa-check"></i><b>5</b> Let’s boost the models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="modeling.html"><a href="modeling.html#burnout-data-1"><i class="fa fa-check"></i><b>5.1</b> Burnout data</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="modeling.html"><a href="modeling.html#baseline-models"><i class="fa fa-check"></i><b>5.1.1</b> Baseline models</a></li>
<li class="chapter" data-level="5.1.2" data-path="modeling.html"><a href="modeling.html#model-specification"><i class="fa fa-check"></i><b>5.1.2</b> Model specification</a></li>
<li class="chapter" data-level="5.1.3" data-path="modeling.html"><a href="modeling.html#tuning"><i class="fa fa-check"></i><b>5.1.3</b> Tuning</a></li>
<li class="chapter" data-level="5.1.4" data-path="modeling.html"><a href="modeling.html#evaluate-and-understand-the-model"><i class="fa fa-check"></i><b>5.1.4</b> Evaluate and understand the model</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="modeling.html"><a href="modeling.html#insurance-data"><i class="fa fa-check"></i><b>5.2</b> Insurance data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>6</b> Conclusion</a></li>
<li class="chapter" data-level="7" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>7</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Boosting methods: Theory and application in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="eda" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Explore the data</h1>
<p>Before one starts with the actual modeling it is crucial to get to know the data and to bring it to the correct format. This process of getting familiar with the data is well known as Exploratory Data Analysis (EDA). To do this many packages are used.<span class="citation">[<a href="references.html#ref-latexplots" role="doc-biblioref">14</a>]</span> The most important ones will be loaded below.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="eda.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># general data handling tools</span></span>
<span id="cb1-2"><a href="eda.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels) <span class="co"># data modeling and preprocessing</span></span>
<span id="cb1-3"><a href="eda.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># color palettes</span></span>
<span id="cb1-4"><a href="eda.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb1-5"><a href="eda.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridisLite)</span>
<span id="cb1-6"><a href="eda.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># composing of ggplots</span></span></code></pre></div>
<p>Before the fun can begin a quick outline of the steps performed on each data set.</p>
<ul>
<li>A general overview of the classes of the features and a visualization to detect any missing values.</li>
<li>The distribution and the main effect on the outcome variable of each feature.</li>
<li>The pairwise relationships of the predictors.</li>
<li>Optionally some feature engineering.</li>
<li>Using the gained knowledge to fix all pre-processing and feature engineering steps by using a <code>recipes::recipe</code>.</li>
</ul>
<p>If one is mainly interested in the models themselves one can just have a look at the recipes and skip the rest of this section.</p>
<p>Some might ask why no interactions of predictors are covered in this EDA. If one would use a standard OLS, lasso or ridge regression it would be very important to have a look at them but as the focus here is on tree-based gradient boosting one already includes interactions if one is not restrictive to regression stumps. So let’s start with the first data set!</p>
<div id="burnout-data" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Burnout data</h2>
<p>The data is from the machine learning challenge <em>HackerEarth Machine Learning Challenge: Are your employees burning out?</em>. And can be downloaded here: <a href="https://www.kaggle.com/blurredmachine/are-your-employees-burning-out?select=train.csv" class="uri">https://www.kaggle.com/blurredmachine/are-your-employees-burning-out?select=train.csv</a></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="eda.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the data</span></span>
<span id="cb2-2"><a href="eda.html#cb2-2" aria-hidden="true" tabindex="-1"></a>burnout_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;_data/burn_out_train.csv&quot;</span>)</span>
<span id="cb2-3"><a href="eda.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># convert colnames to snake_case</span></span>
<span id="cb2-4"><a href="eda.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(burnout_data) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(</span>
<span id="cb2-5"><a href="eda.html#cb2-5" aria-hidden="true" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(</span>
<span id="cb2-6"><a href="eda.html#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(burnout_data),</span>
<span id="cb2-7"><a href="eda.html#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; &quot;</span>,</span>
<span id="cb2-8"><a href="eda.html#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;_&quot;</span></span>
<span id="cb2-9"><a href="eda.html#cb2-9" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb2-10"><a href="eda.html#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># omit missing values in the outcome variable</span></span>
<span id="cb2-11"><a href="eda.html#cb2-11" aria-hidden="true" tabindex="-1"></a>burnout_data <span class="ot">&lt;-</span> burnout_data[<span class="sc">!</span><span class="fu">is.na</span>(burnout_data<span class="sc">$</span>burn_rate),]</span></code></pre></div>
<div id="train-test-split" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Train-test split</h3>
<p>To not allow information leakage the train-test split is performed at the very start of the whole analysis.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="eda.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb3-2"><a href="eda.html#cb3-2" aria-hidden="true" tabindex="-1"></a>burnout_split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(burnout_data, <span class="at">prop =</span> <span class="fl">0.80</span>)</span>
<span id="cb3-3"><a href="eda.html#cb3-3" aria-hidden="true" tabindex="-1"></a>burnout_train <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(burnout_split)</span>
<span id="cb3-4"><a href="eda.html#cb3-4" aria-hidden="true" tabindex="-1"></a>burnout_test  <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(burnout_split)</span></code></pre></div>
<p>The training data set contains 17301 rows and 9 variables.</p>
<p>The test data set contains 4325 observations and naturally also 9 variables.</p>
</div>
<div id="quick-general-overview" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Quick general overview</h3>
<p>First look at the classes of the variables.</p>
<table>
<thead>
<tr class="header">
<th align="left">column</th>
<th align="left">class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">employee_id</td>
<td align="left">character</td>
</tr>
<tr class="even">
<td align="left">date_of_joining</td>
<td align="left">Date</td>
</tr>
<tr class="odd">
<td align="left">gender</td>
<td align="left">character</td>
</tr>
<tr class="even">
<td align="left">company_type</td>
<td align="left">character</td>
</tr>
<tr class="odd">
<td align="left">wfh_setup_available</td>
<td align="left">character</td>
</tr>
<tr class="even">
<td align="left">designation</td>
<td align="left">numeric</td>
</tr>
<tr class="odd">
<td align="left">resource_allocation</td>
<td align="left">numeric</td>
</tr>
<tr class="even">
<td align="left">mental_fatigue_score</td>
<td align="left">numeric</td>
</tr>
<tr class="odd">
<td align="left">burn_rate</td>
<td align="left">numeric</td>
</tr>
</tbody>
</table>
<p>A general visualization of the whole datas set to detect missing values below.</p>
<p><img src="boosting_methods_files/figure-html/visdat-1.png" width="672" /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="eda.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># percentage of missing values in the training data set</span></span>
<span id="cb4-2"><a href="eda.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">rowSums</span>(<span class="fu">is.na</span>(burnout_train)) <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 0.1407433</code></pre>
<p>As we know that XGBoost can handle missing values we do not have to be concerned. Although one could of course think about imputation or even removal.</p>
</div>
<div id="what-about-the-outcome-variable" class="section level3" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> What about the outcome variable?</h3>
<p><code>burn_rate</code>: For each employee telling the rate of burnout should be in <span class="math inline">\([0,1]\)</span>. The greater the score the worse the burnout (0 means no burnout at all). As the variable is continuous we have a regression task. Yet it has bounds which has to be treated with when predicting.</p>
<p>The five point summary below shows that the full range is covered and no invalid values are in the data.</p>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0000  0.3100  0.4500  0.4513  0.5900  1.0000</code></pre>
<p>Now the distribution of the outcome.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-111-1.png" width="672" /></p>
<p>The distribution of the outcome is very much symmetrical and bell shaped around 0.5 and the whole defined region <span class="math inline">\([0,1]\)</span> is covered quite well. Actually by overlaying a normal distribution with the sample mean <span class="math inline">\(\hat{\mu}\)</span> and the sample standard deviation <span class="math inline">\(\hat{\sigma}^2\)</span> as the parameters one can clearly see that the outcome almost perfectly follows a normal distribution. One could further fit a Q-Q-plot to visualize the normality but this will be omitted here as the normality of the outcome is not required for the here covered boosting model.</p>
</div>
<div id="distribution-and-main-effects-of-the-predictors" class="section level3" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> Distribution and main effects of the predictors</h3>
<div id="employee-id" class="section level4" number="4.1.4.1">
<h4><span class="header-section-number">4.1.4.1</span> Employee ID</h4>
<p><code>employee_id</code> is just an ID variable and thus is not useful for any prediction model. But one has to check for duplicates.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="eda.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TRUE if there are NO duplicates</span></span>
<span id="cb7-2"><a href="eda.html#cb7-2" aria-hidden="true" tabindex="-1"></a>burnout_train <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="eda.html#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(employee_id) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="eda.html#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="eda.html#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>() <span class="sc">==</span> <span class="fu">nrow</span>(burnout_train)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Thus there are no duplicates which is good.</p>
</div>
<div id="date-of-joining" class="section level4" number="4.1.4.2">
<h4><span class="header-section-number">4.1.4.2</span> Date of joining</h4>
<p><code>date_of_joining</code> is the date the employee has joined the company. Thus a continuous variable that most likely needs some kind of feature engineering.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-113-1.png" width="672" /></p>
<p>Although there is a lot of variation no major trends in hirings are visible from this plot. Overall the variable seems to be quite equally distributed over the year 2008.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-114-1.png" width="672" /></p>
<p>In its raw form the variable <code>date_of_joining</code> seems not to have a notable main effect on the outcome variable. Nevertheless the feature will be used in the model and as tree-based models have an in-built feature selection one can see after the fitting if the feature was helpful overall. The feature will not be included just as an integer (the default format how Dates are represented) but rather some more features like weekday or month will be extracted from the raw variable further down the road.</p>
</div>
<div id="gender" class="section level4" number="4.1.4.3">
<h4><span class="header-section-number">4.1.4.3</span> Gender</h4>
<p><code>gender</code> represents the gender of the employee. Definitely a categorical variable.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="eda.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># have a look at the discrete distribution</span></span>
<span id="cb9-2"><a href="eda.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">factor</span>(burnout_train<span class="sc">$</span>gender))</span></code></pre></div>
<pre><code>## Female   Male 
##   9101   8200</code></pre>
<p>The two classes are well balanced. Now a look at the main effect of the feature.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-116-1.png" width="672" /></p>
<p>For both classes the distributions are very similar and symmetrical. It seems like the male employees have overall a slightly higher risk of having a higher burn score i.e. a burnout.</p>
</div>
<div id="company-type" class="section level4" number="4.1.4.4">
<h4><span class="header-section-number">4.1.4.4</span> Company type</h4>
<p><code>company_type</code> is a binary categorical variable that indicates whether the company is a service or product company.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="eda.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># have a look at the discrete distribution</span></span>
<span id="cb11-2"><a href="eda.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">factor</span>(burnout_train<span class="sc">$</span>company_type))</span></code></pre></div>
<pre><code>## Product Service 
##    6018   11283</code></pre>
<p>In this case the classes are not fully balanced but each class is still well represented. Now a look at the main effect of the feature.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-118-1.png" width="672" /></p>
<p>For both classes the distributions are almost identical and symmetrical. From an univariate point of view no notable main effect is visible from these visualizations.</p>
</div>
<div id="work-from-home-setup" class="section level4" number="4.1.4.5">
<h4><span class="header-section-number">4.1.4.5</span> Work from home setup</h4>
<p><code>wfh_setup_available</code> indicates whether a working from home setup is available for the employee. So this is again a binary variable.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="eda.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># have a look at the discrete distribution</span></span>
<span id="cb13-2"><a href="eda.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">factor</span>(burnout_train<span class="sc">$</span>wfh_setup_available))</span></code></pre></div>
<pre><code>##   No  Yes 
## 7929 9372</code></pre>
<p>The two classes are well balanced. Now a look at the main effect of the feature.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-120-1.png" width="672" /></p>
<p>Again both distributions are quite similar i.e. bell shaped and symmetrical. Here quite a main effect is visible. A work from home setup most likely has a positive influence on the wellbeing and thus lowers the risk for a high burn rate.</p>
</div>
<div id="designation" class="section level4" number="4.1.4.6">
<h4><span class="header-section-number">4.1.4.6</span> Designation</h4>
<p><code>designation</code> A rate within <span class="math inline">\([0,5]\)</span> that represents the designation in the company for the employee. High values indicate a greater amount of designation.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="eda.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unique values of the feature</span></span>
<span id="cb15-2"><a href="eda.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(burnout_train<span class="sc">$</span>designation)</span></code></pre></div>
<pre><code>## [1] 2 1 3 0 4 5</code></pre>
<p>As the feature has a natural ordering this variable will be treated as an ordinal one i.e. be encoded with the integers and not by one-hot-encoding.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-122-1.png" width="672" /></p>
<p>Here clearly the more extreme levels of designation are less represented in the data. This makes total sense w.r.t. the meaning of the variable.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-123-1.png" width="672" /></p>
<p>A strong main effect is visible in the plot. The plot also further strengthens the hypothesis that we should treat the feature as ordinal. A higher level of designation seems to have an influence on the risk of having a burnout. For example employees from the training data set with a level of designation below 3 never even achieved a maximal burn score of one.</p>
</div>
<div id="resource-allocation" class="section level4" number="4.1.4.7">
<h4><span class="header-section-number">4.1.4.7</span> Resource allocation</h4>
<p><code>resource_allocation</code> A rate within <span class="math inline">\([1,10]\)</span> that represents the resource allocation to the employee. High values indicate more resources allocated to the employee.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="eda.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unique values of the feature</span></span>
<span id="cb17-2"><a href="eda.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(burnout_train<span class="sc">$</span>resource_allocation)</span></code></pre></div>
<pre><code>##  [1]  3  1  7  4  6  5  2 NA  8 10  9</code></pre>
<p>Here again the question is whether one should encode this variable as a categorical or an ordinal categorical feature. In this case as there are quite some levels and again a natural ordering the variable will be encoded as a continuous integer score.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-125-1.png" width="672" /></p>
<p>A similar behavior as the one of the previous variable is visible. But here there are some missing values (NA’s).</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-126-1.png" width="672" /></p>
<p>A strong main effect is visible in the plot. The plot again further strengthens the hypothesis that we should treat this feature as ordinal. A higher amount of resources assigned to an employee seems to have a positive influence on the risk of having a burnout. The missing values do not seem to have some structure as they replicate the base distribution of the outcome variable.</p>
</div>
<div id="mental-fatigue-score" class="section level4" number="4.1.4.8">
<h4><span class="header-section-number">4.1.4.8</span> Mental fatigue score</h4>
<p><code>mental_fatigue_score</code> is the level of mental fatigue the employee is facing.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="eda.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of unique values</span></span>
<span id="cb19-2"><a href="eda.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(burnout_train<span class="sc">$</span>mental_fatigue_score)) </span></code></pre></div>
<pre><code>## [1] 102</code></pre>
<p>This variable will without a question be treated in a continuous way.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-128-1.png" width="672" /></p>
<p>Although there is a very slight skew towards a higher mental fatigue score the overall distribution is still more or less bell shaped and quite symmetrical. Moreover the whole allowed range is covered and the bounds are not violated. Next the main effect of the variable.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-129-1.png" width="672" /></p>
<p>This scatterplot shows drastic results! The mental fatigue score has an almost perfect linear relationship with the outcome variable. This is also underlined by the very high pearson correlation. This indicates that mental fatigue score will be a most important predictor. If a communication with the data collector would be possible it would be important to check whether the two scores have common confounding variables as then one would have to question the practical usability of this predictor. This comes from the fact that no model would be needed if it was as hard to collect the data about the predictors as the outcome data. Moreover there are 1555 missing values in the feature so for those the model has to rely on the other maybe more weak predictors. It should be noted that when evaluating the final model one should consider to compare its performance to a trivial model (like a single intercept model). When constructing such a trivial model one could and maybe should also use this variable (when available) to get a trivial prediction by scaling the <code>mental_fatigue_score</code> feature by a simple scalar.</p>
</div>
</div>
<div id="relationships-between-the-predictors" class="section level3" number="4.1.5">
<h3><span class="header-section-number">4.1.5</span> Relationships between the predictors</h3>
<p>An exploration of the relationships between the predictors could also be done by having a look at a correlation and scatterplot matrix. This approach is much quicker than looking at each pairwise relationship individually but also not as precise as the one presented here. Especially for a lot of features such a matrix can get too big to grasp the subtle details. If this is necessary depends on the use case. A very good option if one wants an initial overview is the function <code>GGally::ggpairs</code>. So in the following each pairwise relationship will be covered.</p>
<div id="date-of-joining-vs.-the-others" class="section level4" number="4.1.5.1">
<h4><span class="header-section-number">4.1.5.1</span> Date of joining vs. the others</h4>
<p><img src="boosting_methods_files/figure-html/ggpairs-1.png" width="90%" /></p>
<p>No major relationship can be detected here.</p>
</div>
<div id="gender-vs.-the-remaining" class="section level4" number="4.1.5.2">
<h4><span class="header-section-number">4.1.5.2</span> Gender vs. the remaining</h4>
<p><strong>Contingency tables for the comparison of two binary features:</strong></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="eda.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gender vs Company type</span></span>
<span id="cb21-2"><a href="eda.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(burnout_train<span class="sc">$</span>gender, burnout_train<span class="sc">$</span>company_type)</span></code></pre></div>
<pre><code>##         
##          Product Service
##   Female    3097    6004
##   Male      2921    5279</code></pre>
<p>No huge tendency visible.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="eda.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gender vs Work from home setup</span></span>
<span id="cb23-2"><a href="eda.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(burnout_train<span class="sc">$</span>gender, burnout_train<span class="sc">$</span>wfh_setup_available)</span></code></pre></div>
<pre><code>##         
##            No  Yes
##   Female 3835 5266
##   Male   4094 4106</code></pre>
<p>Slightly more women have a work from home setup available.</p>
<p><strong>Now the ordinal variables:</strong></p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-133-1.png" width="672" /></p>
<p>It has to be noted again that female and male emplyees are almost equally represented in the data set. Thus one can see from the above plot that the biggest difference in distribution is for the levels 1 and 4 with opposing effects. While male employees more often have a quite high designation of 4 females are the much more frequent employee with designation level 1.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-134-1.png" width="672" /></p>
<p>Here a major shift in distribution is visible towards men getting more resources allocated to them. This reflects the society that still promotes men much more often to high paying jobs that most often come with resource responsibility.</p>
<p><strong>Now the mental fatigue score:</strong></p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-135-1.png" width="672" /></p>
<p>This is of course very similar to the main effect of the <code>gender</code> variable as the outcome and the feature <code>mental_fatigue_score</code> are highly linearly correlated.</p>
</div>
<div id="company-type-vs.-the-remaining" class="section level4" number="4.1.5.3">
<h4><span class="header-section-number">4.1.5.3</span> Company type vs. the remaining</h4>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="eda.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Company type vs Work from home setup</span></span>
<span id="cb25-2"><a href="eda.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(burnout_train<span class="sc">$</span>company_type, burnout_train<span class="sc">$</span>wfh_setup_available)</span></code></pre></div>
<pre><code>##          
##             No  Yes
##   Product 2764 3254
##   Service 5165 6118</code></pre>
<p>No notable trend.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-137-1.png" width="672" /></p>
<p>No trend here either.</p>
</div>
<div id="work-from-home-setup-vs.-the-remaining" class="section level4" number="4.1.5.4">
<h4><span class="header-section-number">4.1.5.4</span> Work from home setup vs. the remaining</h4>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-138-1.png" width="672" /></p>
<p>A work from home setup is way more often available for employees with a lower designation (<span class="math inline">\(\leq 2\)</span>).</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-139-1.png" width="672" /></p>
<p>The same structure as in the previous comparison is visible here again. Employees with a lower amount of resources allocated to them have more often a work from home setup available. This could be due to the fewer responsibilities they have in the business.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-140-1.png" width="672" /></p>
<p>Again this is of course very similar to the main effect of the <code>wfh_setup_available</code> variable as the outcome and the feature <code>mental_fatigue_score</code> are highly linearly correlated.</p>
</div>
<div id="designation-vs-the-remaining" class="section level4" number="4.1.5.5">
<h4><span class="header-section-number">4.1.5.5</span> Designation vs the remaining</h4>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-141-1.png" width="672" /></p>
<p>Here a strong quite linear relationship is visible. This is sensible as often more resource responsibility is given to employees with high designation.</p>
<p>The last two relationships will be omitted here as both for the variable <code>designation</code> as well as for <code>resource_allocation</code> the comparison with <code>mental_fatigue_score</code> will be very similar to the main effect of the two variables. This comes again from the high correlation of the latter with the outcome.</p>
<p>Overall some stronger and mainly less strong relationships between the predictors could be detected. Not like in ordinary least squares regression for gradient tree boosting no decorrelation and normalization of the features is needed. But before one fixes the pre-processing one can try to extract some more information from some features through some feature engineering.</p>
</div>
</div>
<div id="some-feature-engineering" class="section level3" number="4.1.6">
<h3><span class="header-section-number">4.1.6</span> Some feature engineering</h3>
<p>The only variable that allows for reasonable feature engineering is the date of joining predictor. One can try to extract some underlying patterns and see if an effect on the outcome is visible.</p>
<p>First extract the day of the week:</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-142-1.png" width="672" /></p>
<p>No main effect is visible here. So try the month next.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-143-1.png" width="672" /></p>
<p>Again no main effect is visible.</p>
<p>Nevertheless one can include those two variables into the model because as mentioned before tree-based models actually perform a feature selection at each split. So including these just comes at a small computational cost. This minimal pre-processing that is needed when dealing with tree-based models is actually one of its biggest strengths. It is very robust against any kind of weird selection of features with different scales for example. This is one of the reasons, beside the strong predictive power, for the heavy use of such models in data mining applications.<span class="citation">[<a href="references.html#ref-elements" role="doc-biblioref">1</a>]</span></p>
</div>
<div id="create-the-recipe" class="section level3" number="4.1.7">
<h3><span class="header-section-number">4.1.7</span> Create the recipe</h3>
<p>A recipe is an object that defines a series of steps for data pre-processing and feature engineering.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="eda.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">### recipe for xgboost (nominal variables must be dummy variables)</span></span>
<span id="cb27-2"><a href="eda.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># define outcome, predictors and training data set</span></span>
<span id="cb27-3"><a href="eda.html#cb27-3" aria-hidden="true" tabindex="-1"></a>burnout_rec_boost <span class="ot">&lt;-</span> <span class="fu">recipe</span>(burn_rate <span class="sc">~</span> date_of_joining <span class="sc">+</span> gender <span class="sc">+</span></span>
<span id="cb27-4"><a href="eda.html#cb27-4" aria-hidden="true" tabindex="-1"></a>                            company_type <span class="sc">+</span> wfh_setup_available <span class="sc">+</span></span>
<span id="cb27-5"><a href="eda.html#cb27-5" aria-hidden="true" tabindex="-1"></a>                            designation <span class="sc">+</span> resource_allocation <span class="sc">+</span></span>
<span id="cb27-6"><a href="eda.html#cb27-6" aria-hidden="true" tabindex="-1"></a>                            mental_fatigue_score,</span>
<span id="cb27-7"><a href="eda.html#cb27-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> burnout_train) <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="eda.html#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract the date features day of the week and month</span></span>
<span id="cb27-9"><a href="eda.html#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span>(date_of_joining, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">&quot;dow&quot;</span>, <span class="st">&quot;month&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-10"><a href="eda.html#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dummify all nominal features</span></span>
<span id="cb27-11"><a href="eda.html#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb27-12"><a href="eda.html#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># encode the date as integers</span></span>
<span id="cb27-13"><a href="eda.html#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">date_of_joining =</span> <span class="fu">as.integer</span>(date_of_joining))</span>
<span id="cb27-14"><a href="eda.html#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="eda.html#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="do">### recipe for a random forest model for comparison (no dummy encoding needed)</span></span>
<span id="cb27-16"><a href="eda.html#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co"># same as above without dummification but here the na&#39;s have to be</span></span>
<span id="cb27-17"><a href="eda.html#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co"># imputed (here via knn)</span></span>
<span id="cb27-18"><a href="eda.html#cb27-18" aria-hidden="true" tabindex="-1"></a>burnout_rec_rf <span class="ot">&lt;-</span> <span class="fu">recipe</span>(burn_rate <span class="sc">~</span> date_of_joining <span class="sc">+</span> gender <span class="sc">+</span></span>
<span id="cb27-19"><a href="eda.html#cb27-19" aria-hidden="true" tabindex="-1"></a>                         company_type <span class="sc">+</span> wfh_setup_available <span class="sc">+</span></span>
<span id="cb27-20"><a href="eda.html#cb27-20" aria-hidden="true" tabindex="-1"></a>                         designation <span class="sc">+</span> resource_allocation <span class="sc">+</span></span>
<span id="cb27-21"><a href="eda.html#cb27-21" aria-hidden="true" tabindex="-1"></a>                         mental_fatigue_score,</span>
<span id="cb27-22"><a href="eda.html#cb27-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> burnout_train) <span class="sc">%&gt;%</span></span>
<span id="cb27-23"><a href="eda.html#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_string2factor</span>(<span class="fu">all_nominal</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb27-24"><a href="eda.html#cb27-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_knnimpute</span>(resource_allocation, <span class="at">neighbors =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-25"><a href="eda.html#cb27-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_knnimpute</span>(mental_fatigue_score, <span class="at">neighbors =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-26"><a href="eda.html#cb27-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span>(date_of_joining, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">&quot;dow&quot;</span>, <span class="st">&quot;month&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-27"><a href="eda.html#cb27-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">date_of_joining =</span> <span class="fu">as.integer</span>(date_of_joining))</span></code></pre></div>
</div>
</div>
<div id="insurence-data" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Insurence data</h2>
<p>The insurance data set is part of the book <em>Machine Learning with R</em> by Brett Lantz. It can be downloaded here:
<a href="https://raw.githubusercontent.com/stedy/Machine-Learning-with-R-datasets/master/insurance.csv" class="uri">https://raw.githubusercontent.com/stedy/Machine-Learning-with-R-datasets/master/insurance.csv</a></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="eda.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the data</span></span>
<span id="cb28-2"><a href="eda.html#cb28-2" aria-hidden="true" tabindex="-1"></a>insurance_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;_data/insurance.csv&quot;</span>)</span></code></pre></div>
<div id="train-test-split-1" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Train-test split</h3>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="eda.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb29-2"><a href="eda.html#cb29-2" aria-hidden="true" tabindex="-1"></a>ins_split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(insurance_data, <span class="at">prop =</span> <span class="fl">0.80</span>)</span>
<span id="cb29-3"><a href="eda.html#cb29-3" aria-hidden="true" tabindex="-1"></a>ins_train <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(ins_split)</span>
<span id="cb29-4"><a href="eda.html#cb29-4" aria-hidden="true" tabindex="-1"></a>ins_test  <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(ins_split)</span></code></pre></div>
</div>
<div id="a-general-overview" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> A general overview</h3>
<p>A general visualization of the whole data set in order to detect missing values.</p>
<p><img src="boosting_methods_files/figure-html/visdatIns-1.png" width="672" /></p>
<p>So there are no missing values!</p>
</div>
<div id="what-about-the-outcome" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> What about the outcome?</h3>
<p><code>charges</code>: Individual medical costs billed by health insurance.</p>
<p>The five point summary below shows that the no invalid values i.e. negative ones are in the data.</p>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1122    4703    9433   13128   16436   63770</code></pre>
<p>Now the distribution of the outcome.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-147-1.png" width="672" /></p>
<p>Not like the <code>burn_rate</code> previously this target distribution is not at all symmetrical but highly right skewed. A natural thing to do would be a log transformation of the outcome. The resulting <code>log_charges</code> outcome variable is shown below.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-148-1.png" width="672" /></p>
<p>Although such a transformation of the outcome variable is not needed for tree-based modeling it can make the job of the algorithm somewhat easier.</p>
</div>
<div id="distribution-and-main-effects-of-the-predictors-1" class="section level3" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> Distribution and main effects of the predictors</h3>
<div id="age" class="section level4" number="4.2.4.1">
<h4><span class="header-section-number">4.2.4.1</span> Age</h4>
<p><code>age</code>: The age of the insurance contractor. This is naturally a continuous variable.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-149-1.png" width="672" /></p>
<p>A wide range of ages is covered. Notably there is a peak at roughly 18 which means that many fresh adults were observed in this data set.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-150-1.png" width="672" /></p>
<p>There seems to be a strong main effect although it does not seem to be linear. The general trend is that older contractors generally accumulate more medical costs. This is very intuitive.</p>
</div>
<div id="sex" class="section level4" number="4.2.4.2">
<h4><span class="header-section-number">4.2.4.2</span> Sex</h4>
<p><code>sex</code>: The insurance contractors gender. Here either female or male. This means it is a binary variable and will be treated as such.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="eda.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">as.factor</span>(ins_train<span class="sc">$</span>sex))</span></code></pre></div>
<pre><code>## female   male 
##    534    537</code></pre>
<p>The classes are very well balanced. Now the main effect.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-152-1.png" width="672" /></p>
<p>No notable difference can be detected here.</p>
</div>
<div id="body-mass-index" class="section level4" number="4.2.4.3">
<h4><span class="header-section-number">4.2.4.3</span> Body mass index</h4>
<p><code>bmi</code>: The body mass index is providing an understanding of the body composition. It is a ratio composed out of the weight which is divided by the height <span class="math inline">\(\frac{kg}{m^2}\)</span>. Ideally the ratio is between 18.5 and 24.9. The variable is obviously a continuous variable.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-153-1.png" width="672" /></p>
<p>The distribution is bell-shaped and symmetrical roughly around a bmi of 30 which is above the ideal range. Actually only a small amount of the data falls into the normal range here. Moreover the right tail is heavier than the left one. Now a look at the main effect of the variable.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-154-1.png" width="672" /></p>
<p>With some fantasy one can grasp some non-linear patterns on the right side of the plot but beside that no strong main effect is visible here.</p>
</div>
<div id="number-of-children" class="section level4" number="4.2.4.4">
<h4><span class="header-section-number">4.2.4.4</span> Number of children</h4>
<p><code>children</code>: The number of children or dependents covered by the health insurance.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="eda.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unique values of the feature</span></span>
<span id="cb33-2"><a href="eda.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(ins_train<span class="sc">$</span>children)</span></code></pre></div>
<pre><code>## [1] 0 1 3 2 5 4</code></pre>
<p>This could be treated as categorical but as there is a natural ordering it will be encoded by the integers so the treatment is like the one of a continuous feature.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-156-1.png" width="672" /></p>
<p>As one would also think the more children the lower the number of observed values. Especially the numbers greater than 3 are not well represented. If encoded by one-hot-encoding one would have to think about removing these then near-zero-variance variables. But as they will be encoded in a continuous way this is no problem at all. A look at the main effects can now strengthen or weaken this hypothesis of a natural ordering.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-157-1.png" width="672" /></p>
<p>This plot is quite similar to the main effect plot for the <code>age</code> feature. As most likely (will be checked later) the age is positively correlated with the number of children one can observe a rise of the minimal observed charges towards a greater amount of children. The upper two boxplots are built with just a few observations so they should not be interpreted in great detail. Overall there seems to be some kind of main effect.</p>
</div>
<div id="smoking" class="section level4" number="4.2.4.5">
<h4><span class="header-section-number">4.2.4.5</span> Smoking</h4>
<p><code>smoker</code>: Is the contractor smoking? Of course a binary variable.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="eda.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">as.factor</span>(ins_train<span class="sc">$</span>smoker))</span></code></pre></div>
<pre><code>##  no yes 
## 859 212</code></pre>
<p>The classes are not balanced but the class of the smokers is still represented with a good amount of observations. Now a look at the main effect.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-159-1.png" width="672" /></p>
<p>This main effect is as drastic as it is intuitive. Smoking seems to definitely increases the charges. This means that this variable has probably a lot of predictive power.</p>
</div>
<div id="region" class="section level4" number="4.2.4.6">
<h4><span class="header-section-number">4.2.4.6</span> Region</h4>
<p><code>region</code>: The beneficiary’s residential area in the US. Either northeast, southeast, southwest or northwest. This definitely is a categorical variable.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-160-1.png" width="672" /></p>
<p>The four regions are balanced. Now to the main effect.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-161-1.png" width="672" /></p>
<p>No important main effect is detectable from this plot.</p>
</div>
</div>
<div id="relationships-between-the-predictors-1" class="section level3" number="4.2.5">
<h3><span class="header-section-number">4.2.5</span> Relationships between the predictors</h3>
<div id="age-vs-the-others" class="section level4" number="4.2.5.1">
<h4><span class="header-section-number">4.2.5.1</span> Age vs the others</h4>
<p>First the continuous one: <code>bmi</code></p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-162-1.png" width="672" /></p>
<p>No relationship detectable. The pearson correlation is with 0.109 also low.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-164-1.png" width="672" /></p>
<p>The most interesting take away from these four plots is that the hypothesis about the age of the contractors with children seem to be okish except for the ones with more than 3 children. But again this counterintuitive behavior could also be due to the few samples. At this point one might think about encoding the children variable as a categorical but in the following it will be left continuous.</p>
</div>
<div id="sex-vs-the-remaining" class="section level4" number="4.2.5.2">
<h4><span class="header-section-number">4.2.5.2</span> Sex vs the remaining</h4>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-165-1.png" width="672" /></p>
<p>No notable differences.</p>
<p>Contingency table for the binary variable <code>smoker</code>:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="eda.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sex vs smoker</span></span>
<span id="cb37-2"><a href="eda.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(ins_train<span class="sc">$</span>sex, ins_train<span class="sc">$</span>smoker)</span></code></pre></div>
<pre><code>##         
##           no yes
##   female 450  84
##   male   409 128</code></pre>
<p>Slightly more men smoke but the difference is smallish.</p>
</div>
<div id="bmi-vs-the-remaining" class="section level4" number="4.2.5.3">
<h4><span class="header-section-number">4.2.5.3</span> BMI vs the remaining</h4>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-167-1.png" width="672" /></p>
<p>The most notable fact here is that southeast of the US seems to be a little more overweight than the rest.</p>
</div>
<div id="children-vs-the-remaining" class="section level4" number="4.2.5.4">
<h4><span class="header-section-number">4.2.5.4</span> Children vs the remaining</h4>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-168-1.png" width="672" /></p>
<p>In relative terms actually the contractors with three children smoke the most but the other levels seem quite balanced.</p>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-169-1.png" width="672" /></p>
<p>Here no trend is visible.</p>
</div>
<div id="smoker-vs-region" class="section level4" number="4.2.5.5">
<h4><span class="header-section-number">4.2.5.5</span> Smoker vs Region</h4>
<p><img src="boosting_methods_files/figure-html/unnamed-chunk-170-1.png" width="672" /></p>
<p>So the southeast is not only the most overweight region but also the one with the most smokers in relative terms.</p>
<p>This concludes the tour of the pairwise relationships. Of course such an in detail look at all pairwise relationships for both data sets was only possible because there are quite few predictors and is not always needed in this extend. Besides a crystal clear understanding of the data one sees that there is not much room left for feature engineering for the insurance data set. Thus one can go on and define the recipe.</p>
</div>
</div>
<div id="create-the-recipe-1" class="section level3" number="4.2.6">
<h3><span class="header-section-number">4.2.6</span> Create the recipe</h3>
<p>Transformations on the outcome variable are not good practice within a recipe thus this will be done now before hand by adding a new feature i.e. <code>log10_charges</code> to the train and test data set.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="eda.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add the log transformed outcome variable to the data</span></span>
<span id="cb39-2"><a href="eda.html#cb39-2" aria-hidden="true" tabindex="-1"></a>ins_train<span class="sc">$</span>log10_charges <span class="ot">&lt;-</span> <span class="fu">log10</span>(ins_train<span class="sc">$</span>charges)</span>
<span id="cb39-3"><a href="eda.html#cb39-3" aria-hidden="true" tabindex="-1"></a>ins_test<span class="sc">$</span>log10_charges <span class="ot">&lt;-</span> <span class="fu">log10</span>(ins_test<span class="sc">$</span>charges)</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="eda.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="do">### recipe for xgboost (nominal variables must be dummy variables)</span></span>
<span id="cb40-2"><a href="eda.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># define outcome, predictors and training data set</span></span>
<span id="cb40-3"><a href="eda.html#cb40-3" aria-hidden="true" tabindex="-1"></a>ins_rec_boost <span class="ot">&lt;-</span> <span class="fu">recipe</span>(log10_charges <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span></span>
<span id="cb40-4"><a href="eda.html#cb40-4" aria-hidden="true" tabindex="-1"></a>                            bmi <span class="sc">+</span> children <span class="sc">+</span></span>
<span id="cb40-5"><a href="eda.html#cb40-5" aria-hidden="true" tabindex="-1"></a>                            smoker <span class="sc">+</span> region,</span>
<span id="cb40-6"><a href="eda.html#cb40-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> ins_train) <span class="sc">%&gt;%</span></span>
<span id="cb40-7"><a href="eda.html#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dummify all nominal features (sex, smoker, region)</span></span>
<span id="cb40-8"><a href="eda.html#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>())</span>
<span id="cb40-9"><a href="eda.html#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="eda.html#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="do">### recipe for a random forest model for comparison (no dummy encoding needed)</span></span>
<span id="cb40-11"><a href="eda.html#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co"># same as above without dummification </span></span>
<span id="cb40-12"><a href="eda.html#cb40-12" aria-hidden="true" tabindex="-1"></a>ins_rec_rf <span class="ot">&lt;-</span> <span class="fu">recipe</span>(log10_charges <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span></span>
<span id="cb40-13"><a href="eda.html#cb40-13" aria-hidden="true" tabindex="-1"></a>                         bmi <span class="sc">+</span> children <span class="sc">+</span></span>
<span id="cb40-14"><a href="eda.html#cb40-14" aria-hidden="true" tabindex="-1"></a>                         smoker <span class="sc">+</span> region,</span>
<span id="cb40-15"><a href="eda.html#cb40-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> ins_train)</span></code></pre></div>
<p>Having now all the recipes ready one can proceed with modeling. Finally!</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="theory.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="modeling.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["boosting_methods.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
